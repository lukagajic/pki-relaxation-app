<div fxLayout="column" fxLayoutGap="10px">
    <div fxLayoutAlign="center center">
        <h1>Events</h1>
    </div>
    <div *ngIf="currentUser.role == 'admin'">
        <!-- <button (click)="onAddEventClick()" mat-raised-button color="accent">Add new event</button> -->
        <a routerLink="/events/add" mat-raised-button color="accent">
            <mat-icon>
                add
            </mat-icon>
            &nbsp;Add a new event
        </a>
    </div>

    <p *ngIf="eventDataSource.data.length <= 0">There are no available events</p>
    
    <div fxLayoutAlign="center center">
        <mat-form-field>
            <input matInput type="text" (keyup)="doFilter($event.target.value)" placeholder="Filter">
        </mat-form-field>
    </div>
    
    <mat-table [dataSource]="eventDataSource" matSort>
        <!-- Name -->
        <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                Name
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.name }} 
            </mat-cell>
        </ng-container>

        <!-- Description -->
        <ng-container matColumnDef="description">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                Description
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.description }} 
            </mat-cell>
        </ng-container>

        <!-- Category -->
        <ng-container matColumnDef="category">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                Category
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.category | titlecase }} 
            </mat-cell>
        </ng-container>

        <!-- City -->
        <ng-container matColumnDef="city">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                City
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.city }} 
            </mat-cell>
        </ng-container>

        <!-- Address -->
        <ng-container matColumnDef="address">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                Address
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.address }} 
            </mat-cell>
        </ng-container>

        <!-- Starts at -->
        <ng-container matColumnDef="startsAt">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                Starts at
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.startsAt | date }} 
            </mat-cell>
        </ng-container>

        <!-- Ends at -->
        <ng-container matColumnDef="endsAt">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                Ends at
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.endsAt | date }} 
            </mat-cell>
        </ng-container>


        <!-- Expected attendance -->
        <ng-container matColumnDef="expectedAttendance">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
                Expected attendance
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
               {{ event.expectedAttendance }} 
            </mat-cell>
        </ng-container>

        <ng-container matColumnDef="participants">
            <mat-header-cell *matHeaderCellDef>
                Participants
            </mat-header-cell>
            <mat-cell *matCellDef="let event" [class.color-red]="event.status == 'Cancelled'">
                <button mat-raised-button color="accent" (click)="showParticipants(event)">
                    <mat-icon>
                        find_in_page
                    </mat-icon>
                </button>
            </mat-cell>
        </ng-container>

        <!-- Opcije -->
        <ng-container matColumnDef="options">
            <mat-header-cell *matHeaderCellDef>
                Options
            </mat-header-cell>
            <!-- Isprobati sa mat menu -->
            <mat-cell *matCellDef="let event" fxLayoutGap="5px" [class.color-red]="event.status == 'Cancelled'">
                <button [disabled]="isUserJoinedToEvent(event) || event.status == 'Cancelled' || eventService.isEventFinished(event)" (click)="joinEvent(event)" class="btn-option" mat-mini-fab color="primary" matTooltip="Join event">
                    <mat-icon>
                        add
                    </mat-icon>                    
                </button>
               <button (click)="onEditEventClick(event)" class="btn-option" *ngIf="currentUser.role == 'admin'" mat-mini-fab color="accent" matTooltip="Edit event">
                    <mat-icon>
                        edit
                    </mat-icon>
               </button>
               <button (click)="onDelete(event)" class="btn-option" *ngIf="currentUser.role == 'admin'" mat-mini-fab color="warn" matTooltip="Delete event">
                    <mat-icon>
                        delete
                    </mat-icon>
               </button> 
            </mat-cell>
        </ng-container>
        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let rows; columns: displayedColumns;"></mat-row>
    </mat-table>
    <mat-paginator [pageSize]="10" [pageSizeOptions]="[10, 15, 20, 25, 30, 50]"></mat-paginator>
</div>